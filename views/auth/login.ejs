<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Login Form</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="./assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="./assets/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="./assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="./assets/vendors/font-awesome/css/font-awesome.min.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="./assets/css/style.css">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="./assets/images/favicon.png" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300..700&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="container-scroller">
      <div class="container-fluid page-body-wrapper full-page-wrapper">
        <div class="content-wrapper d-flex align-items-center auth">
          <div class="row flex-grow">
            <div class="col-lg-4 mx-auto">
              <div class="auth-form-light text-left p-5">
                <div class="brand-logo">
                  <!-- <img src="./assets/images/logo.svg"> -->
                   <h2 class="text-dark" style="font-family: Teko; font-weight: 700;">AlsoAskExplorer Login Form</h2>
                </div>
                <h4>Hello! let's get started</h4>
                <h6 class="font-weight-light">Sign in to continue.</h6>
                <div id="errorMessages" class="alert alert-danger" style="display: none;"></div>
                <form id="loginForm" class="pt-3">
                  <div class="form-group">
                    <input type="email" class="form-control form-control-lg" id="exampleInputEmail1" placeholder="Email ID" name="email">
                  </div>
                  <div class="form-group">
                    <input type="password" class="form-control form-control-lg" id="exampleInputPassword1" placeholder="Password" name="password">
                  </div>
                  <div class="mt-3 d-grid gap-2">
                    <button type="submit" class="btn btn-block btn-light shadow-sm btn-lg font-weight-medium auth-form-btn">SIGN IN</submit>
                  </div>
                  <div class="my-2 d-flex justify-content-between align-items-center">
                    <div class="form-check">
                      <label class="form-check-label text-muted">
                        <input type="checkbox" class="form-check-input"> Keep me signed in </label>
                    </div>
                    <a href="/request-reset" style="font-family: teko; font-weight: 500;" class="auth-link text-primary">Forgot password?</a>
                  </div>
                  <!-- <div class="mb-2 d-grid gap-2">
                    <button type="button" class="btn btn-block btn-info auth-form-btn">
                      <i class="mdi mdi-google me-2"></i>Login using Google
                    </button>             
                  </div> -->
                  <div class="text-center mt-4 font-weight-light" style="font-family: teko; font-weight: 600 ;"> Don't have an account? <a href="/register" class="text-primary">Create</a>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="./assets/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="./assets/js/off-canvas.js"></script>
    <script src="./assets/js/misc.js"></script>
    <script src="./assets/js/settings.js"></script>
    <script src="./assets/js/todolist.js"></script>
    <script src="./assets/js/jquery.cookie.js"></script>
    <!-- endinject -->

    <!-- Include SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      document.getElementById('loginForm').addEventListener('submit', async function (event) {
          event.preventDefault(); // Prevent default form submission
          
          const form = event.target;
          const formData = new FormData(form);
          const data = Object.fromEntries(formData);
  
          // Disable the login button and change its text to "Logging..."
          const loginButton = form.querySelector('button[type="submit"]');
          loginButton.disabled = true;
          const originalButtonText = loginButton.innerHTML;
          loginButton.innerHTML = 'Logging...';
  
          // Clear previous error messages
          const errorMessagesDiv = document.getElementById('errorMessages');
          errorMessagesDiv.innerHTML = '';
          errorMessagesDiv.style.display = 'none'; // Hide error messages initially
  
          try {
              const response = await fetch('/login', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(data)
              });
  
              const result = await response.json().catch(() => ({ message: 'Unexpected response from server.' }));
  
              // Check if errors exist
              let errors = result.errors;
  
              if (Array.isArray(errors) && errors.length > 0) {
                  // Show error messages in the list
                  const ul = document.createElement('ul');
                  errors.forEach((error) => {
                      const li = document.createElement('li');
                      li.textContent = error.msg;
                      ul.appendChild(li);
                  });
                  errorMessagesDiv.appendChild(ul);
                  errorMessagesDiv.style.display = 'block'; // Show error messages
              }
  
              if (response.ok) {
                  // Redirect to dashboard if login is successful
                  // alert(result.message);

                  // Example: Show a custom alert with auto-close
                  Swal.fire({
                    title: 'Notification',
                    text: result.message, // Replace `result.message` with your dynamic message
                    icon: 'info',
                    timer: 3000, // Auto-close after 3 seconds
                    showConfirmButton: false
                  });


                  window.location.href = '/dashboard';
              } else {
                  errorMessagesDiv.innerHTML = result.message || 'Login failed';
                  errorMessagesDiv.style.display = 'block'; // Show the error message
              }
          } catch (error) {
              // Handle any other errors (network issues, etc.)
              console.error('Error:', error);
              errorMessagesDiv.innerHTML = 'An error occurred. Please try again later.';
              errorMessagesDiv.style.display = 'block'; // Show the error message
          } finally {
              // Re-enable the login button and reset the text after processing
              loginButton.disabled = false;
              loginButton.innerHTML = originalButtonText;
          }
      });
  </script>
  
  </body>
</html>